import pandas as pd

# Load both sheets
df1 = pd.read_excel("data.xlsx", sheet_name="Sheet1")  # PHASE 1-6
df2 = pd.read_excel("data.xlsx", sheet_name="Sheet2")  # PHASE 6-7

# Combine both sheets
df_all = pd.concat([df1, df2], ignore_index=True)

# Clean PHASE column if needed
df_all["PHASE"] = df_all["PHASE"].astype(str).str.strip()

# Step 1: create a PASS column
df_all["PASS"] = df_all["EXPECTED"] == df_all["ACTUAL"]

# Step 2: group by URL and PHASE
grouped = df_all.groupby(["URL", "PHASE"])

# Step 3: calculate total count, pass count, and pass percentage
result = grouped["PASS"].agg(
    total_count="count",
    pass_count="sum"
).reset_index()

result["pass_percentage"] = (result["pass_count"] / result["total_count"]) * 100

# Save results to one Excel sheet
result.to_excel("pass_percentage_all_phases.xlsx", index=False)

print("âœ… Pass percentages for all phases saved to 'pass_percentage_all_phases.xlsx'")
