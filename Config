// Mock all pieces in the chain
WebClient.RequestBodyUriSpec requestBodyUriSpec = mock(WebClient.RequestBodyUriSpec.class);
WebClient.RequestBodySpec requestBodySpec = mock(WebClient.RequestBodySpec.class); // <-- important
WebClient.RequestHeadersSpec<?> requestHeadersSpec = mock(WebClient.RequestHeadersSpec.class);
WebClient.ResponseSpec responseSpec = mock(WebClient.ResponseSpec.class);

// Arrange WebClient chain
when(webClient.post()).thenReturn(requestBodyUriSpec);
when(requestBodyUriSpec.uri(anyString())).thenReturn(requestBodySpec);
when(requestBodySpec.bodyValue(any())).thenReturn(requestHeadersSpec); // <-- now valid
when(requestHeadersSpec.retrieve()).thenReturn(responseSpec);

Cannot resolve method 'thenReturn(RequestHeadersSpec<capture of ?>)'
WebClient.RequestHeadersSpec<?> requestHeadersSpec
    = mock(WebClient.RequestHeadersSpec.class)
