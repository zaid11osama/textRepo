 @Test
    void testBuildGuardianNewPartyModelForPost_Success() throws Exception {
        // Arrange
        Map<String, String> headers = new HashMap<>();
        headers.put(MdmHeaderRequest.INPUT_COUNTRY, "JO");
        headers.put(MdmHeaderRequest.LANGUAGE, "EN");
        headers.put(MdmHeaderRequest.ROLE, null);
        headers.put(MdmHeaderRequest.WITH_CUSTOMER_ID, null);

        String partyId = "P123";
        String reference = "ref-xyz";

        PartyService spyService = Mockito.spy(partyService);

        // Mock internal calls
        doReturn(relationship)
                .when(spyService)
                .getGlobalIdByIdentifer(eq(partyId), eq(Others.CUSTOMER_ID), eq("JO"), any(), any());

        doReturn(reference)
                .when(helperUtils)
                .generateReference();

        doReturn(partyModel)
                .when(spyService)
                .getFullPartyDetails(eq(relationship), eq(headers), eq(reference));

        doReturn(false)
                .when(spyService)
                .checkPartyModelData(any(PartyModel.class));

        doReturn(newPartyModel)
                .when(spyService)
                .mapDtoToModel(eq(partyModel), eq(relationship), eq("EN"), eq("JO"));

        // Act
        NewPartyModel result = spyService.buildGuardianNewPartyModelForPost(headers, partyId);

        // Assert
        assertNotNull(result);
        assertEquals(newPartyModel, result);

        verify(spyService).getGlobalIdByIdentifer(eq(partyId), eq(Others.CUSTOMER_ID), eq("JO"), any(), any());
        verify(spyService).getFullPartyDetails(eq(relationship), eq(headers), eq(reference));
        verify(spyService).mapDtoToModel(eq(partyModel), eq(relationship), eq("EN"), eq("JO"));
    }

    @Test
    void testBuildGuardianNewPartyModelForPost_WhenPartyIdIsNull_ShouldReturnNull() {
        // Act
        NewPartyModel result = partyService.buildGuardianNewPartyModelForPost(new HashMap<>(), null);

        // Assert
        assertNull(result);
    }

    @Test
    void testBuildGuardianNewPartyModelForPost_WhenCustomerNotFound_ShouldThrowException() throws Exception {
        // Arrange
        Map<String, String> headers = new HashMap<>();
        headers.put(MdmHeaderRequest.INPUT_COUNTRY, "JO");
        headers.put(MdmHeaderRequest.LANGUAGE, "EN");

        String partyId = "P123";

        PartyService spyService = Mockito.spy(partyService);

        doReturn(null)
                .when(spyService)
                .getGlobalIdByIdentifer(anyString(), anyString(), anyString(), any(), any());

        // Act & Assert
        assertThrows(IllegalArgumentException.class,
                () -> spyService.buildGuardianNewPartyModelForPost(headers, partyId));
    }
